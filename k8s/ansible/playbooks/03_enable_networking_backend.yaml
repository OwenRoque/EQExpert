- name: Ensure Calico VXLAN settings are applied
  hosts: localhost
  connection: local
  gather_facts: no

  tasks:
    - name: Apply Calico VXLAN settings
      ansible.builtin.blockinfile:
        path: "{{ playbook_dir }}/../../kubespray/inventory/eqexpert/group_vars/k8s_cluster/k8s-net-calico.yml"
        marker: "# {mark} ANSIBLE MANAGED CALICO VXLAN SETTINGS"
        block: |
          # Force VXLAN backend for Calico
          calico_network_backend: vxlan
          # Disable IP-in-IP mode to avoid conflict
          calico_ipip_mode: 'Never'
          # Always use VXLAN encapsulation
          calico_vxlan_mode: 'Always'